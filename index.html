<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <style>
        td {
            background: #DDD;
            width: 28px;
            height: 28px;
            font-size: 20px;
            text-align: center;
        }
    </style>
</head>
<body>
    <table>
    </table>
    <p></p>
    <script>
        const state = {
            gameOver: false,
            direcao: "c", // c=cima, b=baixo, e=esquerda, d=direita
            macas: [
                {y: 1, x: 1, life: 10 },
                {y: 5, x: 8, life: 20 },
                {y: 10, x: 9, life: 30 },
            ],
            cobra: [
                {y: 3, x: 1},
                {y: 4, x: 1},
                {y: 4, x: 2},
                {y: 4, x: 3},
                {y: 5, x: 3},
                {y: 6, x: 3},
            ],
            tabuleiro: [
                [null, null, null, null, null, null, null, null, null, null, null,null, null, null],
                [null, null, null, null, null, null, null, null, null, null, null,null, null, null],
                [null, null, null, null, null, null, null, null, null, null, null,null, null, null],
                [null, null, null, null, null, null, null, null, null, null, null,null, null, null],
                [null, null, null, null, null, null, null, null, null, null, null,null, null, null],
                [null, null, null, null, null, null, null, null, null, null, null,null, null, null],
                [null, null, null, null, null, null, null, null, null, null, null,null, null, null],
                [null, null, null, null, null, null, null, null, null, null, null,null, null, null],
                [null, null, null, null, null, null, null, null, null, null, null,null, null, null],
                [null, null, null, null, null, null, null, null, null, null, null,null, null, null],
                [null, null, null, null, null, null, null, null, null, null, null,null, null, null],
                [null, null, null, null, null, null, null, null, null, null, null,null, null, null],
                [null, null, null, null, null, null, null, null, null, null, null,null, null, null],
                [null, null, null, null, null, null, null, null, null, null, null,null, null, null],
            ]
        }

        function run() {
            atualizaMacas()
            moverCobra()
            render()
        }

        function moverCobra() {
            const cabeca = state.cobra[0]
            if (state.direcao == "c") state.cobra.unshift({ y: cabeca.y - 1, x: cabeca.x })
            if (state.direcao == "b") state.cobra.unshift({ y: cabeca.y + 1, x: cabeca.x })
            if (state.direcao == "e") state.cobra.unshift({ y: cabeca.y, x: cabeca.x - 1 })
            if (state.direcao == "d") state.cobra.unshift({ y: cabeca.y, x: cabeca.x + 1 })
            state.cobra.pop()
        }

        function atualizaMacas() {
            state.macas = state.macas.map(m=>{
                return { ...m, life: m.life - 1 }
            }).filter(m=>m.life > 0)

            // probabilidade de adicionar nova maÃ§a
            const adicionar = Math.floor(Math.random()*10) > 8
            if (adicionar) {
                state.macas.push({
                    x: Math.floor(Math.random()*state.tabuleiro.length),
                    y: Math.floor(Math.random()*state.tabuleiro.length),
                    life: 50
                })
            }
        }


        function render() {
            const p = document.querySelector("p")
            p.innerText = state.direcao
            const table = document.querySelector("table")
            table.innerHTML = null
            state.tabuleiro.forEach((line, y) => {
                const tr = document.createElement("tr")
                line.forEach((cell, x) => {
                    const td = document.createElement("td")
                    // maÃ§as
                    td.innerText = ""
                    const indexMaca = state.macas.findIndex(m => m.y == y && m.x == x)
                    if (indexMaca > -1) {
                        td.innerText = "ðŸŽ"
                    }


                    // corpo cobra
                    td.style.backgroundColor = "F3F3F3";
                    const indexPedaco = state.cobra.findIndex(p => p.y == y && p.x == x)
                    if (indexPedaco > -1) {
                        td.style.backgroundColor = `rgba(0, 200, 0, ${1/(indexPedaco+1)})`
                    }

                    tr.appendChild(td)
                })
                table.appendChild(tr)
            })
        }

        function init() {
            run()
            // setInterval(()=>{
            //     if (state.gameOver) return
            //     run()
            // }, 1000)
        }

        init()

        window.addEventListener("keydown", (ev) => {
            state.direcao 
            if (ev.code == "ArrowUp" && state.direcao != "b") state.direcao = "c";
            if (ev.code == "ArrowDown" && state.direcao != "c") state.direcao = "b";
            if (ev.code == "ArrowLeft" && state.direcao != "d") state.direcao = "e";
            if (ev.code == "ArrowRight" && state.direcao != "e") state.direcao = "d";
            run()
        })

    </script>
</body>
</html>