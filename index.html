<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <style>
        td {
            background: #DDD;
            width: 25px;
            height: 25px;
            font-size: 20px;
            text-align: center;
        }
    </style>
</head>
<body>
    <table>
    </table>
    <p></p>
    <script>
        const state = {
            gameOver: false,
            direcao: "c", // c=cima, b=baixo, e=esquerda, d=direita
            nextDirecao: "c", // próxima direção desejada
            cobra: [
                {y: 3, x: 1},
                {y: 4, x: 1},
                {y: 4, x: 2},
                {y: 4, x: 3},
                {y: 5, x: 3},
                {y: 6, x: 3},
            ],
            tabuleiro: [
                [null, null, null, null, null, null, null, null, null, null, null,null, null, null],
                [null, null, null, null, null, null, null, null, null, null, null,null, null, null],
                [null, null, null, null, null, null, null, null, null, null, null,null, null, null],
                [null, null, null, null, null, null, null, null, null, -1, null,null, null, null],
                [null, null, null, null, null, null, null, null, null, null, null,null, null, null],
                [null, null, null, -1, null, null, null, null, null, null, null,null, null, null],
                [null, null, null, null, null, null, null, null, null, null, null,null, null, null],
                [null, null, null, null, null, null, null, null, null, null, null,null, null, null],
                [null, null, null, null, null, null, null, null, null, null, null,null, null, null],
                [null, null, null, null, null, null, null, null, null, null, null,null, null, null],
                [null, null, null, null, null, null, null, null, null, null, null,null, null, null],
                [null, null, null, null, null, null, null, null, null, null, null,null, null, null],
                [null, null, null, null, null, null, null, null, -1, null, null,null, null, null],
                [null, null, null, null, null, null, null, null, null, null, null,null, null, null],
            ]
        }

        function moverCobra() {
            const cabeca = state.cobra[0]
            if (state.direcao == "c") state.cobra.unshift({ y: cabeca.y - 1, x: cabeca.x })
            if (state.direcao == "b") state.cobra.unshift({ y: cabeca.y + 1, x: cabeca.x })
            if (state.direcao == "e") state.cobra.unshift({ y: cabeca.y, x: cabeca.x - 1 })
            if (state.direcao == "d") state.cobra.unshift({ y: cabeca.y, x: cabeca.x + 1 })
            state.cobra.pop()

            render()
        }


        function render() {
            const p = document.querySelector("p")
            p.innerText = state.direcao
            const table = document.querySelector("table")
            table.innerHTML = null
            state.tabuleiro.forEach((line, y) => {
                const tr = document.createElement("tr")
                line.forEach((cell, x) => {
                    const td = document.createElement("td")
                    // maça
                    if (cell == -1) td.innerText = "🍎"

                    // corpo cobra
                    td.style.backgroundColor = "F3F3F3";
                    const pedaco = state.cobra.find(p => p.y == y && p.x == x)
                    const index = state.cobra.indexOf(pedaco)
                    if (index > 0) {
                        td.style.backgroundColor = `rgba(0, 200, 0, ${1/(index+1)})`
                    }
                    tr.appendChild(td)
                })
                table.appendChild(tr)
            })
        }

        function init() {
            setInterval(()=>{
                if (state.gameOver) return
                moverCobra()
            }, 1000)
        }

        init()

        window.addEventListener("keydown", (ev) => {
            console.log(ev.code)
            state.direcao 
            if (ev.code == "ArrowUp" && state.direcao != "b") state.direcao = "c";
            if (ev.code == "ArrowDown" && state.direcao != "c") state.direcao = "b";
            if (ev.code == "ArrowLeft" && state.direcao != "d") state.direcao = "e";
            if (ev.code == "ArrowRight" && state.direcao != "e") state.direcao = "d";
        })

    </script>
</body>
</html>